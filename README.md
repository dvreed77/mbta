# Playing with MBTA data

## Installation

Documentation is [here][4], but isn't super clear.  Here is what I have been able to do.

1. download [protbuf] [2], a Google project to encode structured data efficiently.  This is important because this is realtime data, and was primarily given as XML files which are easy to read, but not that efficient.  This is a new happy medium.  Here are the commands I needed to install this on my Mac:
	
	```
	./configure
	make
	make install	
	cd python
	python setup.py build
	python setup.py install
	```

2. you are going to need a [.proto] [3] file. Simply, a .proto file is a format file that descibes how the .pb binary file is organized, seems like a cool idea. For transit, this has also been generated by google. This was a bit confusing at first, cause I thought this would be generated by MBTA, but it looks like they are being smart and using a common format.
3. Next you need to compile the .proto file into a .py file that you can then use to process your .pb file.  

	```
	protoc --python_out=. gtfs-realtime.proto
	```
4. That last command created the file `gtfs_realtime_pb2.py`.

## GTFS Files
1. Run run.sh
	```
	chmod 755 run.sh
	./run.sh
	```
	
## Queries

request header needs to be set to accept “application/xml” or 
“application/json” 

### By Route
http://realtime.mbta.com/developer/api/v1/routes?api_key=wX9NwuHnZU2ToO7GmGR9uw 

### ROUTE LIST BY STOP 
This query will return a list of routes that serve a particular stop
http://realtime.mbta.com/developer/api/v1/routesbystop?api_key=wX9NwuHnZU2ToO7GmGR9uw&stop=70065 

### STOP LIST BY ROUTE
This query will return a list of stops for a particular route. 
http://realtime.mbta.com/developer/api/v1/stopsbyroute?api_key=wX9NwuHnZU2ToO7GmGR9uw&route=931_ 

###STOP LIST BY USER LOCATION 
This query will return a list of the five nearest stops from a particular location
http://realtime.mbta.com/developer/api/v1/stopsbylocation?api_key=wX9NwuHnZU2ToO7GmGR9
uw&lat=42.352913&lon=-71.064648 

###SCHEDULED ARRIVALS AND DEPARTURES BY STOP 
This query will return up to the next three scheduled arrivals and departures in the next hour for a 
direction and route for a particular stop. 
http://realtime.mbta.com/developer/api/v1/schedulebystop?api_key=wX9NwuHnZU2ToO7GmGR9u
w&stop=Back%20Bay&route=CR-Providence&direction=0 

###SCHEDULED ARRIVALS AND DEPARTURES BY ROUTE 
This query will return the scheduled arrivals and departures for the next three trips (including trips already 
underway) in a direction for a particular route.
http://realtime.mbta.com/developer/api/v1/schedulebyroute?api_key=wX9NwuHnZU2ToO7GmGR9
uw&route=CR-Providence&direction=0

###SCHEDULED ARRIVALS AND DEPARTURES BY TRIP 
This query will return the scheduled arrivals and departures for a particular trip.
http://realtime.mbta.com/developer/api/v1/schedulebytrip?api_key=wX9NwuHnZU2ToO7GmGR9u
w&trip=CR-Providence-CR-Weekday-807 







[1]: http://realtime.mbta.com/Portal/Content/Documents/MBTA-realtime_DeveloperDocumentation_v1.0.2_2013-06-25.pdf
[2]: https://code.google.com/p/protobuf/downloads/detail?name=protobuf-2.5.0.tar.gz
[3]: https://developers.google.com/transit/gtfs-realtime/gtfs-realtime-proto
[4]: MBTA-realtime_DeveloperDocumentation_v1.0.4_2013-11-05.pdf